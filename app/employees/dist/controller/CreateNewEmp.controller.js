sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/ui/model/Filter","sap/m/MessageBox"],function(e,t,o,s,n){"use strict";return e.extend("employees.controller.EmpMaster",{onInit:function(){this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("RouteNewEmpCreation").attachPatternMatched(this._onRouteMatched,this);this.oGlobalBusyDialog=new sap.m.BusyDialog},_onRouteMatched:function(){let e=this._createEmpModel();this.getView().setModel(e,"oCreateEmpModel");this.getView().setModel(new t({deleteEnabledAddress:false}),"oScreenMode");this.getView().getParent().getParent().setMode("HideMode")},_createEmpModel:function(){return new t({FIRST_NAME:"",MIDDLE_NAME:"",LAST_NAME:"",EMAIL:null,PHONE:null,DATEOFBIRTH:null,DEPT_ID:null,CURRENCY:null,SALARY:null,SEL_PROJECTS:null,SEL_TECHNOLOGIES:null,Address:[],DEPT_NAME:null})},_createAddModel:function(){return new t({COUNTRY_ID:null,COUNTRY_NAME:null,STATE_ID:null,STATE_NAME:null,REGION:null,ADD_TYPE_ID:null,ADD_TYPE:null,LOCATION_DETAILS:null})},onCancelPress:function(){this.oRouter.navTo("RouteMaster");this.getView().getParent().getParent().setMode("ShowHideMode")},onAddTabSelChange:function(){var e=this.getView().byId("AddEmpTable");if(e.getSelectedItems().length!==0){this.getView().getModel("oScreenMode").setProperty("/deleteEnabledAddress",true)}else{this.getView().getModel("oScreenMode").setProperty("/deleteEnabledAddress",false)}},onDeleteAddress:function(){let e=this.getView().getModel("oCreateEmpModel"),t=e.getProperty("/Address"),o=this.getView().byId("AddEmpTable"),s=o.getSelectedItems(),d=this;if(s.length>0)n.confirm("Are you sure you want to delete selected items?",{onClose:function(n){if(n==="CANCEL"){return}let l=d._deleteAddress(s,t);d._executeAfterDeleteAddress(e,o,l)}})},_deleteAddress:function(e,t){var o=[];jQuery.each(e,function(t){o.push(e[t].sId.split("-")[e[t].sId.split("-").length-1])});o.forEach(function(e,o){if(o!==0){e=e-o}t.splice(e,1)});return t},_executeAfterDeleteAddress:function(e,t,o){e.setProperty("/Address",o);t.removeSelections(true);this.onAddTabSelChange()},onEmpAddressCreate:function(){let e=this._createAddModel();this.getView().setModel(e,"oCreateAddModel");o.load({name:"employees.view.AddressValueHelp",controller:this}).then(function e(t){this.addressFragment=t;this.getView().addDependent(this.addressFragment);t.open()}.bind(this))},onCancelAddress:function(){this.addressFragment.close();this.addressFragment.destroy()},onAddCountrySelChange:function(e){let t=e.getParameter("selectedItem").getKey(),o=sap.ui.getCore().byId("AddStateComboBox");if(t?.length>0){let e=[new s("COUNTRY_ID","EQ",t)];o.getBinding("items").filter(e)}},handleAddressTableUpdateFinished:function(e){let t=e.getParameter("total"),o=`Employee Address (${t})`;this.getView().byId("empAddressTableTitle").setText(o)},onAddressOkPress:function(){let e=this.getView().getModel("oCreateEmpModel"),t=this.getView().getModel("oCreateAddModel"),o=e.getProperty("/Address"),s=sap.ui.getCore().byId("AddTypeComboBox"),n=sap.ui.getCore().byId("AddStateComboBox"),d=sap.ui.getCore().byId("AddCountryComboBox");t.setProperty("/ADD_TYPE",s.getSelectedItem()?.getText());t.setProperty("/STATE_NAME",n.getSelectedItem()?.getText());t.setProperty("/COUNTRY_NAME",d.getSelectedItem()?.getText());o.push(t.getData());e.setProperty("/Address",o);this.onCancelAddress()},onSaveEmp:function(){var e=this.getView(),t=this,o=e.getModel("oCreateEmpModel"),s=o.getData(),d=[];this.oGlobalBusyDialog.open();sap.ui.getCore().getMessageManager().removeAllMessages();if(s.Address.length>0){s.Address.forEach(e=>{d.push({COUNTRY_ID:e.COUNTRY_ID,STATE_ID:e.STATE_ID,REGION:e.REGION,LOCATION_DETAILS:e.LOCATION_DETAILS,ADD_TYPE_ID:e.ADD_TYPE_ID})})}let l={FIRST_NAME:s.FIRST_NAME,MIDDLE_NAME:s.MIDDLE_NAME,LAST_NAME:s.LAST_NAME,EMAIL:s.EMAIL,DATEOFBIRTH:s.DATEOFBIRTH,PHONE:parseInt(s.PHONE),SALARY:parseInt(s.SALARY),DEPT_ID:parseInt(s.DEPT_ID.replace(",","")),CURRENCY:s.CURRENCY,LINK_TO_EMP_ADD:d};let r=e.getModel().bindList("/Employees",undefined,undefined,undefined,{$$updateGroupId:"empGroup"});var i=r.create(l);e.getModel().submitBatch("empGroup").then(function(){let e=i.getObject();o.setProperty("/EMP_ID",e.EMP_ID);t._saveAssociations()}).catch(function(e){t.oGlobalBusyDialog.close();n.error(e.toString())})},_saveAssociations:function(){var e=this.getView(),t=this,o=e.getModel("oCreateEmpModel"),s=o.getData(),d=s.EMP_ID,d=typeof d==="string"?parseInt(d):d;let l=e.getModel().bindList("/EmpProjects",undefined,undefined,undefined,{$$updateGroupId:"associationsGroup"});s.SEL_PROJECTS.forEach(e=>{l.create({EMP_ID:d,PROJECT_ID:e})});let r=e.getModel().bindList("/EmpTechnology",undefined,undefined,undefined,{$$updateGroupId:"associationsGroup"});s.SEL_TECHNOLOGIES.forEach(e=>{r.create({EMP_ID:d,TECH_ID:e})});e.getModel().submitBatch("associationsGroup").then(function(){t.oGlobalBusyDialog.close();n.success(`Employee ${d} \n created successfully`,{onClose:function(){e.getParent().getParent().setMode("ShowHideMode");t.oRouter.navTo("RouteMaster")}})}).catch(function(e){t.oGlobalBusyDialog.close();n.error(e.toString())})},handleTechValueHelp:function(){o.load({name:"employees.view.DeptValueHelp",controller:this}).then(function e(t){this.deptValueHelp=t;this.getView().addDependent(this.deptValueHelp);t.open()}.bind(this))},onDeptValueHelpClose:function(){this.deptValueHelp.close();this.deptValueHelp.destroy()},onDeptOkPress:function(){let e=sap.ui.getCore().byId("deptValueHelp"),t=this.getView().getModel("oCreateEmpModel");t.setProperty("/DEPT_ID",e.getSelectedKey());t.setProperty("/DEPT_NAME",e.getSelectedItem()?.getText());this.onDeptValueHelpClose()}})});